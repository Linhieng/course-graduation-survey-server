# 服务端

TODO:

- [ ] 尝试通过在 constants/?.js 中定义一些数组/对象，然后提供一个工具函数，实现更加优雅的拷贝响应体中的 data，让其可以自适应。
- [ ] 打包
- [ ] 添加 eslint
- [ ] 部署前添加日志
- [ ] 自定义请求头代替 cookie
- [ ] 使用 ajv 对请求格式进行校验

## 个人规范

- 代码结构中的文件夹统一在 index.js 中进行导出
- 捕获错误时，目的是为 error 添加 `__explain` 参数进行说明，然后继续抛出。最终错误统一在默认错误处理中间件中处理。暂时没有遇到特殊情况，如果有的话再进行补充说明。
- jsDoc 注释中，对于单个变量的注释，可以添加项目符号。
- 代码中所有常量（比如数字或者字符串），都需要在 constants/ 中添加对应的实际变量，并且在类型声明文件中通过 `typeof import('').constantXX` 定义类型
- 中间件命名以 mid 开头

## 技术要点

- 使用 crypto-js 进行密码的解密
- 使用 MySQL2 的连接池和预处理语句。一条连接的持续时间通常是几秒钟或几分钟。这里的做法是一个请求使用一个连接。所有的 CRUD 语句均采用 promise + 预处理。此处有遇到一个小问题，详见 [discussions/2492]
- 使用 jsDoc + 类型声明文件。没有采用 ts 的原因主要是因为使用 ts 的过程中有很多问题（不借助各种脚手架）。还有的就是 ts 和 jsDoc 在很多地方是共通的，先把 jsDoc 的基础打好，后面技术扎实后，由于代码中有 jsDoc，所以切换为 ts 也不是大问题


[discussions/2492]: https://github.com/sidorares/node-mysql2/discussions/2492
